var otsimo=function(){"use strict";if("undefined"!=typeof otsimo)return otsimo;var e=!1,t=[],i=[],n={settings:{},kv:{},child:{},debug:!1,iOS:!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),isWKWebView:!1,isUIWebView:"undefined"!=typeof otsimonative,sound:!0};window.webkit&&window.webkit.messageHandlers&&(n.isWKWebView=!0);var s=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){var e,n;4==i.readyState&&(e=i.status,200===e||0===e?(n=JSON.parse(i.responseText),t&&t(null,n)):t&&t(e,null))},i.open("GET",e,!0),i.send()},o=function(e){t.push(e)},a=function(){e=!0;for(var i=0;i<t.length;i++)t[i]();t.splice(0,t.length)};return n.log=function(){n.isWKWebView?(console.log.apply(console,arguments),window.webkit.messageHandlers.console.postMessage(JSON.stringify(arguments))):console.log.apply(console,arguments)},n.customevent=function(e,t){n.isWKWebView?window.webkit.messageHandlers.analytics.postMessage({event:e,data:t}):n.isUIWebView?otsimonative.customevent({event:e,data:t}):n.log("customevent",e,t)},n.quitgame=function(){n.isWKWebView?window.webkit.messageHandlers.player.postMessage({event:"quitgame"}):n.isUIWebView?otsimonative.player({event:"quitgame"}):n.log("quit game called")},n.run=function(t){n.log("register function to run"),e?t&&t():o(t)},n.onSettingsChanged=function(e){i.push(e)},n.__callSettingsCallbacks=function(e,t){e&&(n.settings=e),n.sound=t;for(var s=0;s<i.length;s++)i[s](e,t)},n.init=function(){return n.log("initialize of bundle otsimo.js"),n.isWKWebView?void n.log("sandbox won't be initializing"):n.isUIWebView?void n.log("sandbox won't be initializing"):(n.child.firstname="debug",n.child.lastname="user",n.child.language=n.getLanguages()[0],n.width=1024,n.height=768,n.debug=!0,void s("otsimo.json",n.__initManifest))},n.getLanguages=function(){var e=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var t=0;t<navigator.languages.length;t++)e.push(navigator.languages[t]);navigator.userLanguage&&e.push(navigator.userLanguage),navigator.language&&e.push(navigator.language)}return e},n.__init=function(e){return n.log("__init called",e),n.settings=e.settings,n.child=e.child,n.width=e.screen.width,n.height=e.screen.height,n.sound=e.sound,n.root=e.root,s(n.root+"otsimo.json",function(e,t){if(e)n.log("Failed to get otsimo.json, status=",e);else{n.manifest=t;var i=n.root+t.kv_path+"/"+n.child.language+".json";s(i,function(e,t){e?n.log("failed to get kv, status",e):(n.kv=t,n.log("initialized",n),a())})}}),!0},n.__initManifest=function(e,t){e?n.log("Failed to get otsimo.json, status=",e):(n.manifest=t,s(n.manifest.settings,n.__initSettings))},n.__loadKeyValueStore=function(){var e=n.getLanguages(),t=n.manifest.kv_path+"/"+n.manifest.default_language+".json";if(e.length>0)for(var i=0;i<e.length;++i){var o=n.manifest.languages[e[i].substring(0,2)];if(o){t=n.manifest.kv_path+"/"+o+".json";break}}s(t,function(e,t){e?n.log("failed to get kv, status",e):(n.kv=t,n.log("initialized",n),a())})},n.__initSettings=function(e,t){if(e)n.log("failed to get settings,status",e);else{n.log("settings",t);for(var i=Object.keys(t.properties),s=0;s<i.length;++s){var o=t.properties[i[s]];n.settings[o.id]=o["default"]}n.__loadKeyValueStore()}},n}();